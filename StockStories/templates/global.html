<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <head>
		<meta charset="utf-8" />
		<link rel="apple-touch-icon" sizes="76x76" href= "{% static 'img/apple-icon.png' %}">
		<link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>Stock Stories</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no">
		<!--     Fonts and icons     -->
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
		<link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
		<!-- CSS Files -->
		<link href="https://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet" />
		<link href="{% static 'css/now-ui-dashboard.css' %}" rel="stylesheet" />
		<link href="https://getbootstrap.com/docs/4.0/examples/sign-in/signin.css" rel="stylesheet">
        <style type="text/css">
<style type="text/css">

  body{
    background-color:#f9f9f9;
  }

  .buttons{
    margin-left:02px;
    margin-top:02px;
  }

  .buttonright{
    float:right;
    position:relative;
    bottom:30px;
    margin-right:20px;
  }

  .btn-secondary{
    border: 1px solid #b8b9ba;
    border-radius:4px;
  }

  .map_active{
    background-color: #585859 !important;
    color:white !important;
  }

  .switch {
position: relative;
display: inline-block;
width: 120px;
height: 34px;
}

/* Hide default HTML checkbox */
.switch input {display:none;}

/* The slider */
.slider {
position: absolute;
cursor: pointer;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: #8ad88c;
-webkit-transition: .4s;
transition: .4s;
}

.slider:before {
position: absolute;
content: "";
height: 26px;
width: 26px;
left: 4px;
bottom: 4px;
background-color: white;
-webkit-transition: .4s;
transition: .4s;
}

input:checked + .slider {
background-color: gray;
}

input:focus + .slider {
box-shadow: 0 0 1px gray;
}

input:checked + .slider:before {
-webkit-transform: translateX(85px);
-ms-transform: translateX(85px);
transform: translateX(85px);
}

/* Rounded sliders */
.slider.round {
border-radius: 30px;
}

.slider.round:before {
border-radius: 50%;
}

.slider:after
{
content:'OPEN';
color: white;
display: block;
position: absolute;
transform: translate(-50%,-50%);
top: 50%;
left: 50%;
font-size: 10px;
font-family: Verdana, sans-serif;
}

input:checked + .slider:after
{
content:'CLOSE';
}

svg{
  display:block;
  margin:auto;
}

#openmap1{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#openmap2{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#openmap3{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#openmap4{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#closemap1{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#closemap2{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#closemap3{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;
}

#closemap4{
  background-color:#f9f9f9;
  width: 1100px;
  height: 600px;

#cryptomap1{
    background-color:#f9f9f9;
    margin-left:20px;
    margin-top:60px;
    width:1800px;
    height:800px;
  }

  .dot1 {
  height: 25px;
  width: 25px;
  background-color: #f25f52;
  border-radius: 50%;
  display: inline-block;
  margin-left:600px;
}

.dot2 {
height: 25px;
width: 25px;
background-color: #6bd385;
border-radius: 50%;
display: inline-block;
margin-left:300px;
}

.dot1text{
  position:relative;
  bottom:5px;
  font-size:1.2em;
  font-family:'Times New Roman';
  font-weight:bold;
}
}

  </style>

	</head>

<body class="">
    <div class="wrapper ">
      <div class="sidebar" data-color="red">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
    -->
    <script src="{% static 'js/core/jquery.min.js' %}"></script>
<script src="{% static 'js/core/popper.min.js' %}"></script>
<script src="{% static 'js/core/bootstrap.min.js' %}"></script>
<script src="{% static 'js/plugins/perfect-scrollbar.jquery.min.js' %}"> </script>
<!--  Google Maps Plugin    -->
<!-- Chart JS -->
<script src="{% static 'js/plugins/chartjs.min.js' %}"></script>
<!--  Notifications Plugin    -->
<script src="{% static 'js/plugins/bootstrap-notify.js' %}"></script>
<!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
<script src="{% static 'js/now-ui-dashboard.js' %}"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="http://datamaps.github.io/scripts/0.4.4/datamaps.world.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
            <div class="logo">
                <a href="http://localhost:8000/" class="simple-text logo-mini">
                    SS
                </a>
                <a href="http://localhost:8000/" class="simple-text logo-normal">
                    Stock Stories
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li>    
						<a href="stockstories.html">
                            <i class="now-ui-icons design_app"></i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li>
                        <a href="http://localhost:8000/explore/">
                            <i class="now-ui-icons location_compass-05"></i>
                            <p>Explore</p>
                        </a>
                    </li>
					<li>						
                        <a href="http://localhost:8000/crypto">
                            <i class="now-ui-icons business_money-coins"></i>
                            <p>Crypto currency</p>
                        </a>
                    </li>
                    <li>
                        <a href="http://localhost:8000/user">
                            <i class="now-ui-icons users_single-02"></i>
                            <p>User Profile</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="http://localhost:8000/global">
                            <i class="now-ui-icons business_globe"></i>
                            <p> Global Market</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-transparent  navbar-absolute bg-primary fixed-top">
                <div class="container-fluid">
                    <div class="navbar-wrapper">
                        <div class="navbar-toggle">
                            <button type="button" class="navbar-toggler">
                                <span class="navbar-toggler-bar bar1"></span>
                                <span class="navbar-toggler-bar bar2"></span>
                                <span class="navbar-toggler-bar bar3"></span>
                            </button>
                        </div>
                        <a class="navbar-brand" href="#">Global Market </a>
                    </div>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar navbar-kebab"></span>
                        <span class="navbar-toggler-bar navbar-kebab"></span>
                        <span class="navbar-toggler-bar navbar-kebab"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <form>
                            <div class="input-group no-border">
                                <input type="text" value="" class="form-control" placeholder="Search...">
                                <button class="btn btn-link" onclick="search()"> Search </button>
                            </div>
                        </form>
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <i class="now-ui-icons media-2_sound-wave"></i>
                                    <p>
                                        <span class="d-lg-none d-md-block">Graph Modes</span>
                                    </p>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="now-ui-icons users_single-02"></i>
                                    <p>
                                        <span class="d-lg-none d-md-block">User Account</span>
                                    </p>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="user">Profile</a>
                                    <a class="dropdown-item" href="/accounts/logout">Signout</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="panel-header panel-header-sm">
            </div>    
              <div class="buttons">
                <button type = "button" id = "showMap1" class="btn btn-secondary">1D</button> <button type="button" id = "showMap2" class="btn btn-secondary">YTD</button> <button type="button" id = "showMap3" class="btn btn-secondary">1Y</button> <button type="button" id = "showMap4" class="btn btn-secondary">3Y</button>
              </div>

               <div class="buttonright">

              <label class="switch">
                <input type="checkbox" id="toggle" checked="true" />
                <div class="slider round"></div>
              </label>
              </div>

              <div id = "openmap1">
              </div>
              <div id ="closemap1">
              </div>
              <div id = "openmap2">
              </div>
              <div id ="closemap2">
              </div>
              <div id = "openmap3">
              </div>
              <div id ="closemap3">
              </div>
              <div id = "openmap4">
              </div>
              <div id ="closemap4">
              </div>
       <img src="{% static 'screen_label.jpg' %}">
<script type="text/javascript">

  $(document).ready(function(){

    $("#showMap1").addClass("map_active");
    $("#openmap1").show();
    $("#openmap2").hide();
    $("#openmap3").hide();
    $("#openmap4").hide();
    $("#closemap1").hide();
    $("#closemap2").hide();
    $("#closemap3").hide();
    $("#closemap4").hide();
  });

  $("button").click(function(){
  $("button").removeClass("map_active");
  $(this).addClass("map_active");
});

$("#showMap1").click(function(){
  $("#openmap1").show();
  $("#openmap2").hide();
  $("#openmap3").hide();
  $("#openmap4").hide();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap1").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap1").show();
      $("#closemap1").hide();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

$("#showMap2").click(function(){
  $("#openmap1").hide();
  $("#openmap2").show();
  $("#openmap3").hide();
  $("#openmap4").hide();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap2").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap1").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap2").show();
      $("#closemap1").hide();
      $("#openmap1").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

$("#showMap3").click(function(){
  $("#openmap1").hide();
  $("#openmap2").hide();
  $("#openmap3").show();
  $("#openmap4").hide();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap3").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap1").hide();
      $("#closemap2").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap3").show();
      $("#closemap1").hide();
      $("#openmap1").hide();
      $("#openmap2").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

$("#showMap4").click(function(){
  $("#openmap1").hide();
  $("#openmap2").hide();
  $("#openmap3").hide();
  $("#openmap4").show();
  $("#closemap1").hide();
  $("#closemap2").hide();
  $("#closemap3").hide();
  $("#closemap4").hide();
  if ($(this).hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap4").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap1").hide();
      $("#closemap3").hide();
      $("#closemap2").hide();
    } else {
      $("#openmap4").show();
      $("#closemap1").hide();
      $("#openmap1").hide();
      $("#openmap3").hide();
      $("#openmap2").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});


$(function() {
  if ($("#showMap1").hasClass("map_active")){
  $("#toggle").click(function() {
    if ($(this).is(":checked")) {
      $("#openmap1").hide();
      $("#closemap1").show();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    } else {
      $("#openmap1").show();
      $("#closemap1").hide();
      $("#openmap2").hide();
      $("#openmap3").hide();
      $("#openmap4").hide();
      $("#closemap2").hide();
      $("#closemap3").hide();
      $("#closemap4").hide();
    }
  });
}
});

  var data = [{
    color: "#ff0000",
    label: 'Less than -1%'
  }, {
    color: "#ff3838",
    label: '-1 to -0.5%'
  }, {
    color: "#ff7575",
    label: '-0.5 to 0%'
  }, {
    color: "#96dd7e",
    label: '0 to +0.5%'
  }, {
    color: "#5bbc3a",
    label: '+0.5 to +1%'
  }, {
    color: "#218700",
    label: 'Greater than +1%'
  }]

  var width = 1000;
  var height = 50;
  var file = "{% static 'wsj_dataset_compact.csv' %}"

  var svg = d3.select('main-panel')
    .append('svg')
    .attr('width', width)
    .attr('height', height);


    var grad = svg.append('defs')
      .append('linearGradient')
      .attr('id', 'grad')
      .attr('x1', '0%')
      .attr('x2', '100%')
      .attr('y1', '0%')
      .attr('y2', '0%');

      grad.selectAll('stop')
        .data(data)
        .enter()
        .append('stop')
        .attr('offset', function(d, i) {
          return (i / data.length) * 100 + '%';
        })
        .style('stop-color', function(d) {
          return d.color;
        })
        .style('stop-opacity', 0.9);

        svg.append('rect')
          .attr('x', 0)
          .attr('y', 0)
          .attr('width', width)
          .attr('height', height / 2)
          .attr('fill', 'url(#grad)');

        var g = svg.append('g')
          .selectAll('.label')
          .data(data)
          .enter();

        g.append('line')
          .style('stroke', function(d) {
            return d.color;
          })
          .style('stroke-width', 5)
          .attr('x1',function(d,i){
            return xPos(i)
          })
          .attr('x2',function(d,i){
            return xPos(i)
          })
          .attr('y1',function(d,i){
            return height / 2;
          })
           .attr('y2',function(d,i){
            return height
          });


        g.append('text')
          .text(function(d){
            return d.label;
          })
          .attr('transform',function(d,i){
            return 'translate(' + (xPos(i) + 15) + ',' + ((height) - 7) + ')';
          })

        //g.append("title")
        //.attr("title","yo mamam");

        // add title to scale //

        function xPos(i){
          return (width / data.length) * i;
        }

//$("svg").css({bottom: 200, left: 1000, position:'relative'});

var openMap1 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap1'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.daily_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
          done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});
console.log(openmap1)


d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap1.updateChoropleth(csvdata1);
}
);

var closedMap1 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap1'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.daily_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
////////////////
          done: function(closedMap1) {

      closedMap1.svg.selectAll('.datamaps-subunit').on('click', function(geo) {
        //var localData = closedMap1.options.data[geo.id]
        //if ( localData && localData.numberOfThings ) {
        //  alert(localData.numberOfThings)
        //}
        ///////////////////////////
        console.log("yoipeeeee!")
      })
    },
      done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].daily_change_percent >= 0 && csvdata1[i].daily_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].daily_change_percent >0.5 && csvdata1[i].daily_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].daily_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].daily_change_percent < 0 && csvdata1[i].daily_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].daily_change_percent < -0.5 && csvdata1[i].daily_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].daily_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap1.updateChoropleth(csvdata1);
}
);

var openMap2 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap2'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.ytd_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {}
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap2.updateChoropleth(csvdata1);
}
);

var closedMap2 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap2'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.ytd_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].ytd_change_percent >= 0 && csvdata1[i].ytd_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].ytd_change_percent >0.5 && csvdata1[i].ytd_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].ytd_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].ytd_change_percent < 0 && csvdata1[i].ytd_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].ytd_change_percent < -0.5 && csvdata1[i].ytd_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].ytd_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap2.updateChoropleth(csvdata1);
}
);

var openMap3 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap3'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.year_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap3.updateChoropleth(csvdata1);
}
);

var closedMap3 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap3'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.year_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].year_change_percent >= 0 && csvdata1[i].year_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].year_change_percent >0.5 && csvdata1[i].year_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].year_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].year_change_percent < 0 && csvdata1[i].year_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].year_change_percent < -0.5 && csvdata1[i].year_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].year_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap3.updateChoropleth(csvdata1);
}
);

var openMap4 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('openmap4'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.threeYear_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

openMap4.updateChoropleth(csvdata1);
}
);

var closedMap4 = new Datamap(

      {
          scope: 'world',
          projection: 'equirectangular',
          element: document.getElementById('closemap4'),
          // projection: 'mercator',

          geographyConfig: {
                              borderWidth: 0.2,
                              borderColor: 'white',
                          /*  highlightBorderColor: 'black',
                              highlightBorderWidth: 0.5,
                              highlightFillColor: '#FFEC38',

                              highlightOnHover: true,
                              popupOnHover: true, //disable the popup while hovering
  */
                              popupTemplate: function(geography, csvdata1) {
                                  if ( !csvdata1 ) return;  // makes sure that the tooltip is shown only if there is data
                                  return '<div class="hoverinfo">'  + 'Country: <strong>'+csvdata1.country +'</strong>'+ '<br>Index: <strong>'+csvdata1.index + '</strong>'+ '<br> Change:  <strong>' +  csvdata1.threeYear_change_percent + '</strong> %';},
                              },
          fills: {
            '0 to +0.5%':"#96dd7e",
            '+0.5% to +1%':"#5bbc3a",
            'Greater than +1%':"#218700",
            '0 to -0.5%':"#ff7575",
            '-0.5% to -1%':"#ff3838",
            'Less than -1%':"#ff0000",
            'closed1':'rgba(150,221,126,0.3)',
            'closed2':'rgba(91,188,58,0.3)',
            'closed3':'rgba(33,135,0,0.3)',
            'closed4': 'rgba(255,117,117,0.3)',
            'closed5':'rgba(255,56,56,0.3)',
            'closed6':'rgba(255,0,0,0.3)',
            defaultFill: '#d6d6d6'
          },
          data: {},
                done: function(datamap) {

            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {

                //alert(geography.properties.name);
                window.location = '/global/?org='+geography.properties.name
            });

        }
});



d3.csv(file, function(error, csvdata1) {

for (var i=0;i<csvdata1.length;i++)

      {
        csvdata1[i].fillKey = {};

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '0 to +0.5%';
        }

        if (csvdata1[i].threeYear_change_percent >= 0 && csvdata1[i].threeYear_change_percent<=0.5 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed1';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'closed')
        {
          csvdata1[i].fillKey = '+0.5% to +1%';
        }

        if (csvdata1[i].threeYear_change_percent >0.5 && csvdata1[i].threeYear_change_percent<=1 && csvdata1[i].market_status == 'open')
        {
          csvdata1[i].fillKey = 'closed2';
        }

        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Greater than +1%'; }
        if (csvdata1[i].threeYear_change_percent > 1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed3'; }

        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '0 to -0.5%'; }
        if (csvdata1[i].threeYear_change_percent < 0 && csvdata1[i].threeYear_change_percent>= -0.5 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed4'; }

        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = '-0.5% to -1%'; }
        if (csvdata1[i].threeYear_change_percent < -0.5 && csvdata1[i].threeYear_change_percent >= -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed5'; }

        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'closed') {  csvdata1[i].fillKey = 'Less than -1%'; }
        if (csvdata1[i].threeYear_change_percent < -1 && csvdata1[i].market_status == 'open') {  csvdata1[i].fillKey = 'closed6'; }

        csvdata1[ csvdata1[i].country_code] = csvdata1[i] ;
        //console.log(csvdata1[i]);
        delete  csvdata1[i].country_code;

        delete  csvdata1[i] ;
          }

closedMap4.updateChoropleth(csvdata1);
}
);
  </script>
                  <div class="row">
                  <div class="col-md-6">
                    <div class="card card-tasks">
                      <div class="card-header">
                        <h5 class="card-category">News</h5>
                         <h4 class="card-title">{{ org }}
                        <h5 class="card-category"> Date: <h4 class="card-title"> {{ date }} </h4>
                      </div>
                      <div class="card-body">
                        <div class="table-full-width table-responsive">
                          <table class="table">
                            <tbody>
                                {% for data in news %}
                                <tr>
                                    <td>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox">
                                                <span class="form-check-sign"></span>
                                            </label>
                                        </div>
                                    </td>
                                    <td class="text-left" onclick="window.location ='{{ data.url }}'"> {{ data.title }}</td>
                                    <td class="td-actions text-right">
                                        <button type="button" rel="tooltip" title="" class="btn btn-info btn-round btn-icon btn-icon-mini btn-neutral" data-original-title="Edit Task">
                                            <i class="now-ui-icons ui-2_settings-90"></i>
                                        </button>
                                        <button type="button" rel="tooltip" title="" class="btn btn-danger btn-round btn-icon btn-icon-mini btn-neutral" data-original-title="Remove">
                                            <i class="now-ui-icons ui-1_simple-remove"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}   
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <div class="card-footer">
                        <hr>
                        <div class="stats">
                          <i class="now-ui-icons loader_refresh spin"></i> Updated
                        </div>
                      </div>
                  </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card card-tasks">
                      <div class="card-header">
                        <h5 class="card-category">Tweets</h5>
                        <h4 class="card-title">{{ org }}
                        <h5 class="card-category"> Date: <h4 class="card-title"> {{ date }} </h4>
                      </div>
                      <div class="card-body">
                        <div class="table-full-width table-responsive">
                          <table class="table">
                            <tbody>
                                {% for data in tweet %}
                                <tr>
                                    <td>
                                        <div class="form-check">
                                            <label class="form-check-label">
                                                <input class="form-check-input" type="checkbox">
                                                <span class="form-check-sign"></span>
                                            </label>
                                        </div>
                                    </td>
                                    <td class="text-left" onclick="window.location ='{{ data.url }}'"> {{ data.text }}</td>
                                    <td class="td-actions text-right">
                                        <button type="button" rel="tooltip" title="" class="btn btn-info btn-round btn-icon btn-icon-mini btn-neutral" data-original-title="Edit Task">
                                            <i class="now-ui-icons ui-2_settings-90"></i>
                                        </button>
                                        <button type="button" rel="tooltip" title="" class="btn btn-danger btn-round btn-icon btn-icon-mini btn-neutral" data-original-title="Remove">
                                            <i class="now-ui-icons ui-1_simple-remove"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}   
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <div class="card-footer">
                        <hr>
                        <div class="stats">
                          <i class="now-ui-icons loader_refresh spin"></i> Updated
                        </div>
                      </div>
                  </div>
                  </div>
                  </div>
                
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <ul>
                            <li>
                                <a href="https://localhost:8000/">
                                    Github-Source
                                </a>
                            </li>
                            <li>
                                <a href="about">
                                    About Us
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <div class="copyright">
                        &copy;
                        <script>
                            document.write(new Date().getFullYear())
                        </script>, Designed and developed by
                        <a>StockStories Team</a>.
                    </div>
                </div>
            </footer>
        </div>
    </div>
</body>
<!--   Core JS Files   -->

</html>
	   